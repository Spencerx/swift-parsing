<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parsing - OneOf</title>
    <link rel="stylesheet" type="text/css" href="/swift-parsing/all.css" media="all" />
</head>
<body>
    <header>
        <a href="/swift-parsing/">
            <strong>
                Parsing
            </strong>
            <span>Documentation</span>
        </a>
    </header>

    <!--
    <form class="search">
        <input type="search" placeholder="Search" />
    </form>
    -->

    <nav>
        <div class="wrapper">
            <h2>On This Page</h2>
            <ol><li><a href="#relationships">Relationships</a><ul><li><a href="#relationships">Conforms To</a></li></ul></li><li><a href="#initializers">Initializers</a><ul><li class="initializer"><a href="#oneof.init(_:)">init(_:​)</a></li></ul></li><li><a href="#properties">Properties</a><ul><li class="variable"><a href="#oneof.parsers">parsers</a></li></ul></li><li><a href="#methods">Methods</a><ul><li class="function"><a href="#oneof.parse(_:)">parse(_:​)</a></li></ul></li></ol>
        </div>
    </nav>

    <main>
        <article>
            <h1>
    <small>Structure</small>
    <code class="name">One​Of</code>
</h1>

<div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">struct</span> <span class="type">OneOf</span>&lt;<span class="variable">Parsers</span>&gt;: <a href="/swift-parsing/Parser"><span class="type">Parser</span></a> <span class="keyword">where</span> <a href="/swift-parsing/Parsers"><span class="type">Parsers</span></a>: <a href="/swift-parsing/Parser"><span class="type">Parser</span></a>  </body></html></code></pre>
</div>
<div class="summary" role="doc-abstract">
    <p>A parser that attempts to run a number of parsers till one succeeds.</p>

</div>
<div class="discussion">
    <html><body><pre class="highlight"><code><span class="keyword">enum</span> <span class="type">Currency</span> { <span class="keyword">case</span> <span class="variable">eur</span>, <span class="variable">gbp</span>, <span class="variable">usd</span> }

<span class="keyword">let</span> <span class="variable">currency</span> = <span class="variable">OneOf</span> {
  <span class="string literal">"</span><span class="string literal">€</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">eur</span> }
  <span class="string literal">"</span><span class="string literal">£</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">gbp</span> }
  <span class="string literal">"</span><span class="string literal">$</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">usd</span> }
}
</code></pre></body></html>
<p>If you are optionally parsing input that should coalesce into some default, you can skip the
optionality and instead use <code>OneOf</code> with an <code>Always</code> parser, given a default:</p>

<html><body><pre class="highlight"><code><span class="keyword">enum</span> <span class="type">Currency</span> { <span class="keyword">case</span> <span class="variable">eur</span>, <span class="variable">gbp</span>, <span class="variable">usd</span>, <span class="variable">unknown</span> }

<span class="keyword">let</span> <span class="variable">currency</span> = <span class="variable">OneOf</span> {
  <span class="string literal">"</span><span class="string literal">€</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">eur</span> }
  <span class="string literal">"</span><span class="string literal">£</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">gbp</span> }
  <span class="string literal">"</span><span class="string literal">$</span><span class="string literal">"</span>.<span class="variable">map</span> { <span class="variable">Currency</span>.<span class="variable">usd</span> }
  <span class="variable">Always</span>(<span class="variable">Currency</span>.<span class="variable">unknown</span>)
}
</code></pre></body></html>
<h1>Backtracking</h1>

<p><code>OneOf</code> will automatically revert any changes made to input when one of its parsers fails. This
process is often called &quot;backtracking&quot;, and simplifies the logic of other parsers by not forcing them
to be responsible for their own backtracking when they fail.</p>

<p>If used naively, backtracking can lead to less performant parsing code. For example, if we wanted to parse
two integers from a string that were separated by either a dash &quot;-&quot; or slash &quot;/&quot;, then we could write this
as:</p>

<html><body><pre class="highlight"><code><span class="variable">OneOf</span> {
  <span class="variable">Parser</span> { <span class="variable">Int</span>.<span class="variable">parser</span>(); <span class="string literal">"</span><span class="string literal">-</span><span class="string literal">"</span>; <span class="variable">Int</span>.<span class="variable">parser</span>() } <span class="comment">// 1️⃣</span>
  <span class="variable">Parser</span> { <span class="variable">Int</span>.<span class="variable">parser</span>(); <span class="string literal">"</span><span class="string literal">/</span><span class="string literal">"</span>; <span class="variable">Int</span>.<span class="variable">parser</span>() } <span class="comment">// 2️⃣</span>
}
</code></pre></body></html>
<p>However, parsing slash-separated integers is not going to be performant because it will first run the
entire 1️⃣ parser until it fails, then backtrack to the beginning, and run the 2️⃣ parser. In particular,
the first integer will get parsed twice, unnecessarily repeating that work.</p>

<p>On the other hand, we can factor out the common work of the parser and localize the backtracking <code>OneOf</code>
work to make a much more performant parser:</p>

<html><body><pre class="highlight"><code><span class="variable">Parse</span> {
  <span class="variable">Int</span>.<span class="variable">parser</span>()
  <span class="variable">OneOf</span> { <span class="string literal">"</span><span class="string literal">-</span><span class="string literal">"</span>; <span class="string literal">"</span><span class="string literal">/</span><span class="string literal">"</span> }
  <span class="variable">Int</span>.<span class="variable">parser</span>()
}
</code></pre></body></html>
</div>
<section id="relationships">
    <h2 hidden>Relationships</h2>
        <figure>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %995 Pages: 1 -->
<svg width="872pt" height="116pt"
 viewBox="0.00 0.00 872.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)">
<title>%995</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-112 868,-112 868,4 -4,4"/>
<!-- OneOf -->
<g id="node1" class="node structure current">
<title>OneOf</title>
<g id="a_node1"><a xlink:href="/swift-parsing/OneOf" xlink:title="OneOf">
<path fill="none" stroke="#000000" stroke-width="3" d="M528,-108C528,-108 336,-108 336,-108 330,-108 324,-102 324,-96 324,-96 324,-84 324,-84 324,-78 330,-72 336,-72 336,-72 528,-72 528,-72 534,-72 540,-78 540,-84 540,-84 540,-96 540,-96 540,-102 534,-108 528,-108"/>
<text text-anchor="middle" x="432" y="-86.3" font-family="Menlo" font-size="14.00" fill="#000000">OneOf</text>
</a>
</g>
</g>
<!-- Parser -->
<g id="node2" class="node protocol">
<title>Parser</title>
<g id="a_node2"><a xlink:href="/swift-parsing/Parser" xlink:title="Parser">
<path fill="none" stroke="#000000" d="M528,-36C528,-36 336,-36 336,-36 330,-36 324,-30 324,-24 324,-24 324,-12 324,-12 324,-6 330,0 336,0 336,0 528,0 528,0 534,0 540,-6 540,-12 540,-12 540,-24 540,-24 540,-30 534,-36 528,-36"/>
<text text-anchor="middle" x="432" y="-14.3" font-family="Menlo" font-size="14.00" fill="#000000">Parser</text>
</a>
</g>
</g>
<!-- OneOf&#45;&gt;Parser -->
<g id="edge1" class="edge conformsTo">
<title>OneOf&#45;&gt;Parser</title>
<path fill="none" stroke="#000000" d="M432,-71.8314C432,-64.131 432,-54.9743 432,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="435.5001,-46.4132 432,-36.4133 428.5001,-46.4133 435.5001,-46.4132"/>
</g>
</g>
</svg>


    <figcaption hidden>Inheritance graph for OneOf.</figcaption>
</figure>
        <h3>Conforms To</h3>
<dl>
    <dt class="protocol"><code><a href="/swift-parsing/Parser">Parser</a></code></dt>
<dd><p>Declares a type that can parse an <code>Input</code> value into an <code>Output</code> value.</p>
</dd>
</dl>
</section>
    <section id="initializers">
        <h2>Initializers</h2>

        <div role="article" class="initializer" id="oneof.init(_:)">
    <h3>
        <code><a href="#oneof.init(_:)">init(_:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="attribute">@</span><span class="attribute">inlinable</span>
  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="attribute">@</span><a href="/swift-parsing/OneOfBuilder"><span class="type">OneOfBuilder</span></a> <span class="keyword">_</span> <span class="variable">build</span>: () -&gt; <a href="/swift-parsing/Parsers"><span class="type">Parsers</span></a>)  </body></html></code></pre>
</div>
</div>
    </section>
    <section id="properties">
        <h2>Properties</h2>

        <div role="article" class="variable" id="oneof.parsers">
    <h3>
        <code><a href="#oneof.parsers">parsers</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">let</span> <span class="variable">parsers</span>: <a href="/swift-parsing/Parsers"><span class="type">Parsers</span></a></body></html></code></pre>
</div>
</div>
    </section>
    <section id="methods">
        <h2>Methods</h2>

        <div role="article" class="function" id="oneof.parse(_:)">
    <h3>
        <code><a href="#oneof.parse(_:)">parse(_:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="attribute">@</span><span class="attribute">inlinable</span>
  <span class="keyword">public</span> <span class="keyword">func</span> <span class="function">parse</span>(<span class="keyword">_</span> <span class="variable">input</span>: <span class="keyword">inout</span> <a href="/swift-parsing/Parsers"><span class="type">Parsers</span></a>.<span class="type">Input</span>) -&gt; <a href="/swift-parsing/Parsers"><span class="type">Parsers</span></a>.<span class="type">Output</span>?  </body></html></code></pre>
</div>
</div>
    </section>



        </article>
    </main>

    <footer>
        <p>
    Generated on <time datetime="2022-02-09T19:21:26+0000">February 9, 2022</time> using <a href="https://github.com/SwiftDocOrg/swift-doc">swift-doc</a> <span class="version">1.0.0-rc.1</span>.
</p>
    </footer>
</body>
</html>
